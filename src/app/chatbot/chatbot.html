<!-- src/app/components/chatbot/chatbot.component.html -->
<div class="chatbot-container">
  <!-- Chat Toggle Button -->
  <button 
    class="chat-toggle-btn btn btn-primary rounded-circle position-fixed" 
    (click)="toggleChat()"
    [class.chat-open]="isChatOpen">
    <i class="fas fa-comments" *ngIf="!isChatOpen"></i>
    <i class="fas fa-times" *ngIf="isChatOpen"></i>
  </button>

  <!-- Chat Window -->
  <div class="chat-window card shadow-lg position-fixed" [class.show]="isChatOpen">
    <!-- Chat Header -->
    <div class="chat-header card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center">
        <div class="bot-avatar me-2">
          <i class="fas fa-robot"></i>
        </div>
        <div>
          <h6 class="mb-0">Travel Assistant</h6>
          <small class="status">
            <span class="status-indicator" [class.online]="isConnected" [class.offline]="!isConnected"></span>
            {{ isConnected ? 'Online' : 'Connecting...' }}
          </small>
        </div>
      </div>
      <div class="chat-actions">
        <button class="btn btn-sm btn-outline-light me-1" (click)="newChat()" title="New Chat">
          <i class="fas fa-plus"></i>
        </button>
        <button class="btn btn-sm btn-outline-light" (click)="toggleChat()" title="Close">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <!-- Messages Container -->
    <div class="messages-container" #messagesContainer>
      <div class="messages-content p-3">
        <!-- Welcome Message or Chat Messages -->
        <div *ngFor="let message of messages; trackBy: trackByMessage" 
             class="message mb-3" 
             [class.user-message]="message.isFromUser" 
             [class.bot-message]="!message.isFromUser">
          
          <div class="message-content">
            <!-- Bot Avatar -->
            <div class="avatar" *ngIf="!message.isFromUser">
              <i class="fas fa-robot"></i>
            </div>

            <!-- Message Bubble -->
            <div class="message-bubble" [class.user-bubble]="message.isFromUser" [class.bot-bubble]="!message.isFromUser">
              <div class="message-text" [innerHTML]="formatMessage(message.content)"></div>
              <div class="message-time">
                {{ message.timestamp | date:'short' }}
              </div>
            </div>

            <!-- User Avatar -->
            <div class="avatar" *ngIf="message.isFromUser">
              <i class="fas fa-user"></i>
            </div>
          </div>

          <!-- Suggestions -->
          <div class="suggestions mt-2" *ngIf="message.suggestions && message.suggestions.length > 0">
            <button 
              class="btn btn-outline-primary btn-sm me-2 mb-2 suggestion-btn" 
              *ngFor="let suggestion of message.suggestions"
              (click)="onSuggestionClick(suggestion)">
              {{ suggestion.text }}
            </button>
          </div>

          <!-- Additional Data (like search results preview) -->
          <div class="message-data mt-2" *ngIf="message.data">
            <div class="data-preview bg-light p-2 rounded">
              <small class="text-muted">Related information found</small>
            </div>
          </div>
        </div>

        <!-- Typing Indicator -->
        <div class="message bot-message mb-3" *ngIf="isTyping">
          <div class="message-content">
            <div class="avatar">
              <i class="fas fa-robot"></i>
            </div>
            <div class="message-bubble bot-bubble typing-indicator">
              <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="chat-input card-footer bg-light">
      <div class="input-group">
        <textarea 
          #messageInput
          class="form-control" 
          placeholder="Type your message..."
          [(ngModel)]="currentMessage"
          (keydown)="onKeyPress($event)"
          rows="1"
          style="resize: none; max-height: 100px;"
          [disabled]="!isConnected">
        </textarea>
        <button 
          class="btn btn-primary" 
          type="button" 
          (click)="sendMessage()"
          [disabled]="!currentMessage.trim() || !isConnected">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
      <div class="input-help mt-1" *ngIf="!isConnected">
        <small class="text-muted">
          <i class="fas fa-exclamation-triangle me-1"></i>
          Connecting to chat service...
        </small>
      </div>
    </div>
  </div>
</div>